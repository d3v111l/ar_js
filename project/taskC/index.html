<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>AR Хімічна Симуляція</title>
    <script src="https://aframe.io/releases/1.4.2/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/ar.js@3.4.2/aframe/build/aframe-ar.min.js"></script>
    <style>
      body { margin: 0; overflow: hidden; }
      canvas { position: absolute; top: 0; left: 0; }
    </style>
  </head>
  <body>
    <a-scene embedded arjs>
      <!-- Камера -->
      <a-entity camera position="0 1.6 0"></a-entity>

      <!-- Каталізатор -->
      <a-sphere id="catalyst" position="0 0 -1" radius="0.2" color="gold"></a-sphere>

      <!-- Контейнер для молекул -->
      <a-entity id="molecule-container"></a-entity>

      <!-- Освітлення -->
      <a-light type="ambient" color="#FFFFFF"></a-light>
      <a-light type="point" intensity="1" position="2 4 4"></a-light>
    </a-scene>

    <script>
      const moleculeCount = 10;
      const moleculeContainer = document.getElementById('molecule-container');
      const catalyst = document.getElementById('catalyst');
      const molecules = [];

      function randomPositionAroundUser(radius = 1.5) {
        const angle = Math.random() * 2 * Math.PI;
        const y = Math.random() * 1 + 0.5;
        const x = Math.cos(angle) * radius;
        const z = Math.sin(angle) * radius;
        return { x, y, z };
      }

      function createMolecule(id) {
        const el = document.createElement('a-sphere');
        el.setAttribute('radius', '0.1');
        el.setAttribute('color', '#00BFFF');
        el.setAttribute('id', `mol-${id}`);
        const pos = randomPositionAroundUser();
        el.setAttribute('position', `${pos.x} ${pos.y} ${pos.z}`);
        moleculeContainer.appendChild(el);
        return { el, pos, velocity: { x: 0, y: 0, z: 0 } };
      }

      function initMolecules() {
        for (let i = 0; i < moleculeCount; i++) {
          molecules.push(createMolecule(i));
        }
      }

      function getDistance(p1, p2) {
        const dx = p1.x - p2.x;
        const dy = p1.y - p2.y;
        const dz = p1.z - p2.z;
        return Math.sqrt(dx * dx + dy * dy + dz * dz);
      }

      function simulateReactions() {
        for (let i = 0; i < molecules.length; i++) {
          for (let j = i + 1; j < molecules.length; j++) {
            const molA = molecules[i];
            const molB = molecules[j];
            const dist = getDistance(molA.pos, molB.pos);

            const catalystDist = getDistance(molA.pos, catalyst.object3D.position);
            const isNearCatalyst = catalystDist < 0.8;
            const reactionThreshold = isNearCatalyst ? 0.4 : 0.25;

            if (dist < reactionThreshold) {
              molA.el.setAttribute('color', '#FF4500');
              molB.el.setAttribute('color', '#FF4500');
              setTimeout(() => {
                molA.el.setAttribute('visible', 'false');
                molB.el.setAttribute('visible', 'false');
              }, 500);
            }
          }
        }
      }

      function animateMolecules() {
        molecules.forEach(mol => {
          const offset = 0.005;
          mol.pos.x += (Math.random() - 0.5) * offset;
          mol.pos.y += (Math.random() - 0.5) * offset;
          mol.pos.z += (Math.random() - 0.5) * offset;
          mol.el.setAttribute('position', `${mol.pos.x} ${mol.pos.y} ${mol.pos.z}`);
        });
      }

      function renderLoop() {
        animateMolecules();
        simulateReactions();
        requestAnimationFrame(renderLoop);
      }

      window.addEventListener('DOMContentLoaded', () => {
        initMolecules();
        renderLoop();
      });
    </script>
  </body>
</html>
